---
title: 模版元编程
date: 2025-10-11 14:34:41
categories: cpp
---

模板元编程TMP是C++在编译期执行计算和类型操作的编程范式，本质是用代码生成代码，核心思想是将运行时计算转移到编译期，从而提升性能，增强类型安全并实现零开销抽象。

# 核心概念  
元编程，编写操作程序本身的代码，而非直接解决问题。

# 编译器计算
所有计算在代码编译阶段完成，运行时无额外开销：

```cpp
    // 传统运行时阶乘
    int factorial(int n) { 
        return (n <= 1) ? 1 : n * factorial(n-1);  // 递归消耗栈空间
    }

    // 模板元编程实现（编译期计算）
    template <int N>
    struct Factorial {
        static constexpr int value = N * Factorial<N-1>::value;
    };
    template <>
    struct Factorial<0> {
        static constexpr int value = 1;  // 递归终止
    };

    // 编译时即计算出 Factorial<5>::value = 120
```

# 模板特化

为特定类型/值提供定制实现，构成TMP的逻辑分支基础：

```cpp
    // 通用模板
    template <typename T>
    struct IsPointer {
        static constexpr bool value = false;
    };

    // 指针类型的特化
    template <typename T>
    struct IsPointer<T*> {
        static constexpr bool value = true;  // 对指针返回true
    };

    static_assert(IsPointer<int*>::value, "Must be pointer");  // 编译期验证
```
