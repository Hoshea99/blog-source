---
title: 乐观锁/悲观锁
date: 2025-10-31 13:48:58
categories: os
---

乐观锁和悲观锁是处理并发数据访问的两种策略，下文将简要介绍这两种锁：

<!--more-->

# 悲观锁

- 假设：认为数据冲突很常见，每次操作都可能被其他事务干扰
- 机制：在操作数据前先加锁（如数据库的行锁、表锁）
- 典型实现：SELECT ... FOR UPDATE（数据库）
- 适用场景：写操作频繁、冲突概率高的场景
- 缺点：并发性能较低，可能造成阻塞

# 乐观锁

- 假设：认为数据冲突很少发生，允许多个事务同时读取
- 机制：不加锁，但在更新时检查数据是否被修改（通常通过版本号或时间戳）
- 典型实现：CAS（Compare-And-Swap）、版本号机制
- 适用场景：读多写少、冲突概率低的场景
- 缺点：冲突时操作会失败，需要重试逻辑对比示例



悲观锁：像"先占座后吃饭"——提前锁定资源
乐观锁：像"先点餐后结账"——最后时刻检查冲突

实际选择需根据业务场景的读写比例、冲突概率和性能要求综合考虑。



> 读写锁属于悲观锁
>
> 多个线程可以同时获取读锁，不阻塞其他读操作
>
> 写锁排他，有写锁时其他读写锁都被阻塞
